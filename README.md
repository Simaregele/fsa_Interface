# Документация по проекту FSA Interface

## Описание

Веб-интерфейс для поиска, просмотра, редактирования и генерации документов FSA с поддержкой работы как с локальными, так и с удалёнными API-сервисами.

---

## Структура проекта

- **fsa_search_app.py** — точка входа, основной файл запуска Streamlit-приложения.
- **requirements.txt** — список зависимостей Python.
- **config.json** — конфигурация сервисов (режим работы, адреса, эндпоинты).
- **API.md** — документация по REST API.
- **config/** — настройки и загрузка конфигурации.
- **src/** — основной исходный код:
  - **ui/** — компоненты пользовательского интерфейса (форма поиска, таблица, редактирование).
  - **api/** — функции для работы с API (поиск, детализация, обновление, синхронизация).
  - **auth/** — аутентификация пользователя, хранение токенов.
  - **utils/** — утилиты, генерация и отображение документов.
  - **manual_db_update/** — обработка ручных обновлений БД.
  - **config/** — page_config для Streamlit.
  - **services/** — (зарезервировано под сервисный слой).
- **tests/** — тесты (пока не реализованы).

---

## Быстрый старт

1. **Установите зависимости:**
   ```bash
   pip install -r requirements.txt
   ```
2. **Создайте и заполните `config.json` в корне проекта** (пример ниже).
3. **Запустите приложение:**
   ```bash
   streamlit run fsa_search_app.py
   ```
4. **Откройте в браузере адрес, указанный Streamlit (обычно http://localhost:8501).**
5. **Войдите под своим логином/паролем (через Auth API).**
6. **Пользуйтесь поиском, редактированием, генерацией документов.**

---

## Пример config.json (режим remote, тестовый сервер)

```json
{
  "mode": "remote",
  "services": {
    "auth": {
      "base_url": "http://localhost:8082",
      "remote_url": "http://fsa.cargo-trans.pro/api/auth-api",
      "endpoints": { "token": "/token" }
    },
    "registry": {
      "base_url": "http://localhost:8081",
      "remote_url": "http://fsa.cargo-trans.pro/api/search-api",
      "endpoints": {
        "search": "/search",
        "search_one": "/search_one",
        "document_by_number": "/documents/by-number",
        "document_by_id": "/documents/{doc_type}/{doc_id}"
      }
    },
    "document": {
      "base_url": "http://localhost:8080",
      "remote_url": "http://fsa.cargo-trans.pro/api/loader-api",
      "endpoints": {
        "update_document": "/documents/{doc_type}/{doc_id}",
        "sync_document": "/sync-document/{doc_type}/{doc_id}"
      }
    }
  }
}
```

---

## Используемые адреса сервисов (режим remote)

| Назначение                | Адрес (remote)                                               |
|---------------------------|-------------------------------------------------------------|
| Получение токена          | http://fsa.cargo-trans.pro/api/auth-api/token               |
| Поиск документов          | http://fsa.cargo-trans.pro/api/search-api/search            |
| Поиск одного документа    | http://fsa.cargo-trans.pro/api/search-api/search_one        |
| Документ по номеру        | http://fsa.cargo-trans.pro/api/search-api/documents/by-number|
| Детали документа          | http://fsa.cargo-trans.pro/api/search-api/documents/{doc_type}/{doc_id} |
| Обновление документа      | http://fsa.cargo-trans.pro/api/loader-api/documents/{doc_type}/{doc_id} |
| Синхронизация документа   | http://fsa.cargo-trans.pro/api/loader-api/sync-document/{doc_type}/{doc_id} |

---

## Как изменить адреса и режим работы

- Все настройки адресов и режимов работы меняются только в файле **config.json** в корне проекта.
- Для переключения между локальным и удалённым сервером меняйте поле `"mode"` на `"local"` или `"remote"`.
- Для изменения адресов сервисов — редактируйте соответствующие `"remote_url"` и `"base_url"`.
- После изменения конфига перезапустите приложение.

---

## Основные возможности

- Поиск документов по множеству параметров
- Просмотр и сравнение детальных данных
- Редактирование полей (бренд, материалы и др.) прямо в таблице
- Отправка изменений через API (PUT /documents/{type}/{id})
- Генерация файлов по выбранным документам
- Поддержка работы с локальными и удалёнными сервисами (режимы local/remote)
- Гибкая настройка через config.json
- Логирование всех запросов и изменений

---

## Важные замечания

- Для работы с удалёнными сервисами переключите "mode": "remote" в config.json. В случае тестового сервера будет remote.
- После редактирования данных изменения появятся в поиске с задержкой (после синхронизации индекса).
- Для расширения редактируемых полей добавьте нужные колонки в UI и логику обработки.
- Все логи пишутся через стандартный Python-логгер (logging).
- Для тестирования и CI рекомендуется реализовать тесты в папке tests/.

---

## Документация по API

См. файл [API.md](API.md) — описаны все эндпоинты, структура запросов и ответов, особенности авторизации, поддерживаемые поля для обновления.

---

## Контакты и поддержка

Для вопросов и доработок обращайтесь к текущему мейнтейнеру проекта или в команду разработки. 